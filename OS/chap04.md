# 4장 쓰레드

## 4.1 프로세스 및 쓰레드

### 프로세스

- 실행 중인 프로그램
- CPU 레지스터 정보, 스케줄링 정보

현대 OS : task vs thread로 구분

- 테스크 : 사용자 문맥, 시스템 문맥
- 스레드 : 제어 흐름 ( 실행 정보, 레지스터 문맥)

### 단일쓰레딩과 멀티쓰레딩

단일 프로세스 내 멀티 쓰레드 실행을 지원

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c13c2a97-0cdc-4cd6-85f1-e680ee130618/efe9228f-e0c8-4d4e-86ab-fdb975b26ce3/Untitled.png)

멀티 쓰레딩 환경

- 테스크 관련 사항
- 쓰레드 관련 사항
    - 실행 상태
    - 수행중이 아닐 때 저장되는 쓰레드 문맥(저장소)
    - 실행 스택
    - 지역 변수 저장을 위한 정적 저장소 - thread local storage
    - 자신이 속한 프로세스의 메모리 및 자원들에 대한 접근 공유 (global)

### 쓰레드 장점

- 프로세스에 비해 새로운 쓰레드 생성,종료 시간 빠름
- 한 프로세스 내 두 쓰레드 사이 교환,교체 시간 짧음
- 병행 서버
- 다중처리기 → 효율적

### 단일 사용자 멀티프로세싱 시스템에서의 쓰레드의 사용

- 전면과 후면 작업 : 응용 속도 향상
- 비동기 처리 : 요청 들어오면 worker 스레드에 넘기고 다시 요청 받음
- 빠른 수행 : 멀티 스레드 프로세스로 실제적 동시 수행 가능
- 모듈 프로그램 구조 : 기능별로 설계, 구현

멀티 스레드의 장점

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c13c2a97-0cdc-4cd6-85f1-e680ee130618/b5613cd4-f952-4dce-a118-1efe3bdcdf94/Untitled.png)

### 쓰레드의 기능

- 스레드 상태
    - 수행, 준비, 블록
    - 기본적인 쓰레드 연산 : 생성, 디스패치, 블록, 비블록, 종료
- 스레드 동기화
    - 한 프로세스 내 모든 쓰레드 → 동일 주소공간, 자원 공유
    - 공유 자원 : 전역 변수, 파일, 힙
    - 공유 자원 동시 접근시

## 2. 쓰레드의 유형

### 사용자 수준 쓰레드(ULT)

- 응용이 모든 스레드 관리 책임 (커널 의존 x)
- 커널이 스레드 존재 모름
- 스레드 라이브러리 : 쓰레드 생성, 제거, 데이터 전송, 동기화, 스케줄, 문맥교환 함
- 장점
    - 스레드 교환시 커널 모드 권한 필요 x
    - 특정 응용에 적합한 스케줄링 가능
    - 모든 os 수행 가능
- 단점
    - 한 스레드가 블록상태 유발 시스템 호출 할 경우 → 그 프로세스 내 모든 스레드 블록
    - 다중 처리기 장점 x
    - 커널 루틴 자체가 다중쓰레딩 될 수 x

### 커널 수준 쓰레드(KLT)

- 커널이 프로세스, 스레드 대한 문맥 정보 관리
- 커널 수준에서 스레드 대한 스케줄링 실행
- ex) Windows

### 스레드와 프로세스 관계

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c13c2a97-0cdc-4cd6-85f1-e680ee130618/51310c8f-f92b-4ccb-9e4b-74c24dee0c7f/Untitled.png)

## 3. 멀티코어와 멀티 쓰레딩

멀티 코어가 성능에 미치는 영향

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c13c2a97-0cdc-4cd6-85f1-e680ee130618/e8205931-425a-4fe8-aa58-5530eec339ed/Untitled.png)

### 멀티코어 성능 향상이 많은 응용

- 멀티쓰레드화 된 네이티브 응용
    - 원래부터 멀티 스레드 감안해서 만든 응용
- 멀티프로세스 응용
    - 다수의 단일 스레드화된 프로세스들이 존재한다는 의미
- 자바 응용
    - 기본적 스레딩 지원
    - JVM도 자바 응용에 대한 멀티스레드화된 프로세스
- 멀티 인스턴스 응용
    - 다수의 응용 인스턴스 → 병렬 실행 → 속도 향상

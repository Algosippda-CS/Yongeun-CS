# 6장 병행성 : 교착상태와 기아

## 1. 교착상태 원리

### 교착상태의 정의

- 영속적인 블록 상태
- 2개 이상의 프로세스들이 공유자원에 대해 경쟁
- ex) 메모리 할당, 디스크와 테이프 통한 백업, 통신

### 교착상태 4가지 조건

필요충분 조건 

- 상호배제 : 한번에 하나의 프로세스만 자원을 사용
- 점유대기 : 할당하고있으면서 다른 자원 달라 함
- 비선점 : 프로세스가 hold하고 있는 자원 다른 프로세스가 뺏지 x
- 환형대기

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c13c2a97-0cdc-4cd6-85f1-e680ee130618/e6566665-c10f-4584-b490-012261ca569a/Untitled.png)

### 교착상태 해결 위한 3가지 접근 방법

- 교착 상태 예방
    
    (strict) 교착상태 조건 4가지 중 하나 발생 안하도록 함
    
- 교착 상태 회피
    
    현재 할당 상황 보고 데드록 안걸리는 방향으로 고름
    
- 교착 상태 발견
    
    교착상태 발견하고 조치를 취함
    

## 2. 교착상태 예방

교착 상태 발생을 위한 필요충분 조건 4가지 중 하나를 설계단계에서 배제

- 상호배제 : 운영체제에서 반드시 보장. but 적절x
- 점유대기 : 프로세스 필요한 모든 자원 한번에 요청 → 현실적x
- 비선점 : 새로운 자원 요청 실패시 기존 자원들 반납, 다시 요청 / 강제 자원 반납 → 지금까지 한 알고리즘 다 없앨순 없음
- 환형 대기 : 자원 할당 순서 정의

⇒ 예방 사실상 불가능

## 3. 교착상태 회피

4가지 조건중 1,2,3은 허용, 4처럼 자원 할당 순서 미리 정하지 않음

### 시스템 상태

- 안전한 상태  : 교착 상태 발생하지 않도록 자원 할당할 수 있는 진행경로 존재
- 안전하지 않은 상태 : 안전한 자원 할당할 경로가 없음
- 자원 할당 거부 : 교착상태 가능성 여부 동적으로 판단
- 프로세스 시작 거부 : 발생할 가능성 있으면 시작 거부

### 장점

- 교착상태 발견에 비해 선점, 롤백 필요 없음 → 미리 막아서
- 교착상태 예방에 비해 덜 제한적이다

### 단점

- 프로세스 종료할 때까지 필요한 자원들 미리 알려줘야됨
- 프로세스가 독립적이어야하고 동기화되면 안됨
- 자원의 개수가 고정되어야함
- 자원 갖고 있을 때 중간 종료 안됨

## 4. 교착상태 발견

- 예방 : 매우 보수적 → 자주 발견시 부하걸림
- 발견 : 예방의 반대 접근 방법 사용 → 발생 허용 & 복구

### 교착상태 발견 알고리즘

- 행렬 A에서 행의 값이 모두 0인 프로세스 우선 표기
- 임시 벡터 W 만듬 → 가용벡터 V를 W의 초기값으로 설정
- 표기되지 않은 것 중 수행 완료 가능한것 있으면 표시 / 없으면 종료
- 3번 조건 만족하는 행 찾으면 임시벡터에 더한다

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/c13c2a97-0cdc-4cd6-85f1-e680ee130618/ccb98d1a-8251-4148-8e8b-46e3f6a43778/Untitled.png)

### 회복

- 모든 프로세스 종료
- 교착상태에 연관된 프로세스 체크 포인트로 롤백후 다시 수행
- 교착 상태 없어질 때 까지 포함된 프로세스 하나씩 종료
- 교착 상태 얿어질 때 까지 포함된 자원 하나씩 선점
- 종료, 선점될 프로세스 선택 기준
    - 지금까지 사용한 처리기 시간이 적은
    - 지금까지 생산한 출력량이 적은
    - 이후 남은 수행시간이 가장 긴
    - 할당받은 자원이 가장 적은
    - 우선순위가 낮은
